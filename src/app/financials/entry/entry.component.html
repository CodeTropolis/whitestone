<div *ngIf="category && showView">

    <div *ngIf="!costExists; else transactionButtons">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <h4>Please enter a starting amount for {{category.val}}.</h4>
            <mat-form-field>
                <input type=number step=0.01 matInput placeholder="{{category.val}} Cost" formControlName="{{costKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="Memo" formControlName="{{costMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <ng-template #transactionButtons>
        <h3> Current Category: {{category.val}}</h3>
        <h4>Starting Cost: {{this.cost | currency}} | Balance: {{balance | currency}}</h4>
        <div class="buttons">
            <button mat-flat-button color="primary" *ngIf="category.key === 'tuition'" (click)="showPaymentForm()">Enter
                Payment
            </button>
            <span *ngIf="category.key !== 'tuition'">
                <button mat-flat-button color="primary" (click)="showPaymentForm()">Enter Credit</button>
                <button mat-flat-button color="primary" (click)="showDeductionForm()">Enter Deduction</button>
            </span>
            <button *ngIf="hasHistory" mat-flat-button color="primary" (click)="toggleHistory()">History</button>
        </div>
    </ng-template>

    <div *ngIf="isEnteringPayment">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <mat-form-field>
                <input *ngIf="category.key === 'tuition'" type=number step=0.01 matInput placeholder="{{category.val}} Payment" formControlName="{{paymentKey}}">
                <input *ngIf="category.key !== 'tuition'" type=number step=0.01 matInput placeholder="{{category.val}} Credit" formControlName="{{paymentKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="Memo" formControlName="{{paymentMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <div *ngIf="isEnteringDeduction">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <mat-form-field>
                <input type=number step=0.01 matInput placeholder="{{category.val}} Deduction" formControlName="{{deductionKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="{{category.val}} Memo" formControlName="{{deductionMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <div *ngIf="showHistory" class="history">
    <!-- <div [hidden]="!showHistory" class="history"> -->

        <hr />

        <h3>Transaction History for {{category.val}}</h3>

        <mat-table [dataSource]="transactions" matSort>

            <ng-container matColumnDef="amount">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Amount</mat-header-cell>
                <mat-cell *matCellDef="let row">
                    <span [class.deduction]="row.type === 'Deduction'"> {{row.amount | currency}}</span>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="type">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Type</mat-header-cell>
                <mat-cell *matCellDef="let row">
                    <span [class.deduction]="row.type === 'Deduction'">{{row.type}}</span>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="date">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Date</mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.date | date:"medium"}} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="memo">
                <mat-header-cell *matHeaderCellDef mat-sort-header>Memo</mat-header-cell>
                <mat-cell *matCellDef="let row"> {{row.memo}} </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="historyTableColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: historyTableColumns;"></mat-row>
        </mat-table>
    </div>
</div>