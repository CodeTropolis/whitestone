<div *ngIf="category && showView">

    <div *ngIf="!costExists; else transactionButtons">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <h4>Please enter a starting amount for {{category.val}}.</h4>
            <mat-form-field>
                <input type=number step=0.01 matInput placeholder="{{category.val}} Cost" formControlName="{{costKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="Memo" formControlName="{{costMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <ng-template #transactionButtons>
        <h4> {{category.val}} Balance: {{balance | currency}}</h4>
        <div class="buttons">
            <button mat-flat-button color="primary" *ngIf="category.key === 'tuition'" (click)="showPaymentForm()">Enter Payment</button>
            <span *ngIf="category.key !== 'tuition'">
                <button mat-flat-button color="primary" (click)="showPaymentForm()">Enter Credit</button>
                <button mat-flat-button color="primary" (click)="showDeductionForm()">Enter Deduction</button>
            </span>
            <button *ngIf="hasHistory" mat-flat-button color="primary" (click)="toggleHistory()">History</button>
        </div>
    </ng-template>

    <div *ngIf="isEnteringPayment">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <mat-form-field>
                <input *ngIf="category.key === 'tuition'" type=number step=0.01 matInput placeholder="{{category.val}} Payment" formControlName="{{paymentKey}}">
                <input *ngIf="category.key !== 'tuition'" type=number step=0.01 matInput placeholder="{{category.val}} Credit" formControlName="{{paymentKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="Memo" formControlName="{{paymentMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <div *ngIf="isEnteringDeduction">
        <form *ngIf="formGroup" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <mat-form-field>
                <input type=number step=0.01 matInput placeholder="{{category.val}} Deduction" formControlName="{{deductionKey}}">
            </mat-form-field>
            <mat-form-field>
                <input type=text matInput placeholder="{{category.val}} Memo" formControlName="{{deductionMemoKey}}">
            </mat-form-field>
            <button mat-flat-button color="primary" *ngIf="showSubmitButton" [disabled]="!formGroup.valid" type="submit">Submit</button>
        </form>
    </div>

    <div *ngIf="showHistory">
        <ul *ngFor="let p of payments">
            <li>Payment: {{p.payment | currency}} | {{p.date | date:"medium"}} | Memo: {{p.memo}}</li>
        </ul>
        <ul *ngFor="let d of deductions">
            <li>Deduction: {{d.deduction | currency}} | {{d.date | date:"medium"}} | Memo: {{d.memo}}</li>
        </ul>
    </div>
</div>