
<!-- Issue: Within the form, "Enter starting balance for.."  will display briefly until startingBalance is resolved
    Solution: Show spinner until checkForBalance is completed -->
    <!-- Only want spinner to show when a category has been selected -->
<mat-card>
    <div *ngIf="!formReady && currentCategory else entry"> 
        <app-progress-spinner></app-progress-spinner>
    </div>
    
    <ng-template #entry>

        <p *ngIf="currentCategory && (startingBalance || startingBalance == 0)"><strong>{{currentCategory.val}}</strong> 
           <span style="color:darkgray;"> Starting Balance: {{startingBalance | currency}} </span>| 
            Running Balance:  <span [class.credit] = "balanceIsNegative">{{runningBalance | currency}} </span>
            <span *ngIf="balanceIsNegative" class="credit"> (Student Credit)</span></p>
        
        <p *ngIf="currentCategory && !userIsAdmin && showStartingBalanceInput">Financial data for {{currentCategory.val}} is pending.</p>

        <form *ngIf="currentCategory && userIsAdmin" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
            <!-- Now that form is ready, check for a starting balance to determine which form controls to show -->
           <div *ngIf="showStartingBalanceInput else transaction">  
                <h3>Enter starting balance for {{currentCategory.val}}</h3>
                <mat-form-field>
                    <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Start Bal." formControlName="amount">
                </mat-form-field>
            </div>
    
            <ng-template #transaction>
               
                    
                   <div>
                        <button mat-flat-button type="button" (click)="enterPayment()">Enter Payment</button>
                        <button mat-flat-button type="button" (click)="enterCharge()">Enter Charge</button>
                            <!-- history button should be availabe to both admin and non admin users.-->
                        <button *ngIf="paymentsCollectionExists || chargesCollectionExists" 
                        mat-flat-button color="primary" type="button" (click)="toggleHistory()">History</button>

                        <!-- <button *ngIf="currentCategory" class="payment"  mat-flat-button color="primary" 
                        type="button" color="financial" (click)="goToURL('https://stteresabelleville.weshareonline.org/')">Make a Payment</button> -->
                   </div>
                  
                    <mat-form-field *ngIf="isEnteringPayment">
                        <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Payment" formControlName="amount">
                    </mat-form-field>
            
                    <mat-form-field *ngIf="isEnteringCharge">
                        <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Charge" formControlName="amount">
                    </mat-form-field>
            </ng-template>
    
            <!-- Date picker and memo will show for entering balance, payment and charge -->
         
              <div *ngIf="showStartingBalanceInput || (isEnteringCharge || isEnteringPayment)">

                    <mat-form-field>
                        <input matInput [matDatepicker]="transactionDatePicker" placeholder="Date" formControlName="date">
                        <mat-datepicker-toggle matSuffix [for]="transactionDatePicker"></mat-datepicker-toggle>
                        <mat-datepicker #transactionDatePicker></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field>
                        <input matInput type=text placeholder="Memo" formControlName="memo">
                    </mat-form-field>
              </div>
          
            <button mat-flat-button color="primary" [disabled]="!formGroup.valid || disableSubmitButton" type="submit">Submit</button>
        </form>

           <!-- history button should be availabe to both admin and non admin users.-->
           <button *ngIf="(paymentsCollectionExists || chargesCollectionExists) && !userIsAdmin && currentCategory" 
           mat-flat-button color="primary" type="button" (click)="toggleHistory()">History</button>

           <!-- <button *ngIf="currentCategory && !userIsAdmin" class="payment"  mat-flat-button color="primary" 
           type="button" color="financial" (click)="goToURL('https://stteresabelleville.weshareonline.org/')">Make a Payment</button> -->
          
    </ng-template>
</mat-card>