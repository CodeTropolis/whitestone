
<button [disabled]="!enableCatButtons" 
    mat-flat-button color="primary" *ngFor="let cat of categories | mapToIterable"
    (click)="setCategoryPropsAndCollections(cat)">{{cat.val}}</button>

<!-- Issue: Within the form, "Enter starting balance for.."  will display briefly until startingBalance is resolved
    Solution: Show spinner until checkForBalance is completed -->
    <!-- Only want spinner to show when a category has been selected -->
<div *ngIf="!formReady && currentCategory else form"> 
    <app-progress-spinner></app-progress-spinner>
</div>

<ng-template #form>
    <form *ngIf="currentCategory" [formGroup]="formGroup" #formDirective="ngForm" (ngSubmit)="submitHandler(formDirective)">
        <!-- Now that form is ready, check for a starting balance to determine which form controls to show -->
       <div *ngIf="!startingBalance else transaction">  
            <h3>Enter starting balance for {{currentCategory.val}}</h3>
            <mat-form-field>
                <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Start Bal." formControlName="amount">
            </mat-form-field>
        </div>

        <ng-template #transaction>
            <p><strong>{{currentCategory.val}}</strong> Starting Balance: {{startingBalance | currency}} | 
                Running Balance:  <span [class.credit] = "balanceIsNegative">{{runningBalance | currency}} </span>
                <span *ngIf="balanceIsNegative" class="credit"> (Student Credit)</span></p>
                
            <div class="button-group">
                <div *ngIf="userIsAdmin">
                    <button mat-flat-button type="button" (click)="enterPayment()">Enter Payment</button>
                    <button mat-flat-button type="button" (click)="enterCharge()">Enter Charge</button>
                </div>
                 <!-- history button should be availabe to both admin and non admin users.-->
                 <button [disabled]="!paymentsCollectionExists && !chargesCollectionExists" 
                 mat-flat-button color="primary" type="button" (click)="toggleHistory()">History</button>
            </div>

            <div style="display: block;">
                <mat-form-field *ngIf="isEnteringPayment">
                    <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Payment" formControlName="amount">
                </mat-form-field>
        
                <mat-form-field *ngIf="isEnteringCharge">
                    <input matInput type=number step=0.01 placeholder="{{currentCategory.val}} Charge" formControlName="amount">
                </mat-form-field>
            </div>

        </ng-template>

        <!-- Date picker and memo will show for entering balance, payment and charge -->
        <mat-form-field>
            <input matInput [matDatepicker]="transactionDatePicker" placeholder="Date" formControlName="date">
            <mat-datepicker-toggle matSuffix [for]="transactionDatePicker"></mat-datepicker-toggle>
            <mat-datepicker #transactionDatePicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field>
            <input matInput type=text placeholder="Memo" formControlName="memo">
        </mat-form-field>
        <button mat-flat-button color="primary" [disabled]="!formGroup.valid || disableSubmitButton" type="submit">Submit</button>
    </form>
</ng-template>